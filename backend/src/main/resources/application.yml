server:
  port: 8080

spring:
  application:
    name: agent-guard
  profiles:
    active: dev

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:agent_guard}?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:root}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: 0

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    # 跳过 MySQL 5.7 版本检查（建议升级到 MySQL 8.0+）
    ignore-migration-patterns: "*:*"

mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.agentguard.**.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: assign_uuid
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html

# JWT 配置
jwt:
  secret: ${JWT_SECRET:agentguard-secret-key-must-be-at-least-256-bits-long-for-hs256}
  expiration: ${JWT_EXPIRATION:86400}

logging:
  level:
    com.agentguard: DEBUG
    org.springframework.security: DEBUG

# 告警配置
alert:
  default-recipient: ${ALERT_DEFAULT_RECIPIENT:admin@agentguard.com}
  email:
    enabled: ${ALERT_EMAIL_ENABLED:false}
    from: ${ALERT_EMAIL_FROM:}
  webhook:
    timeout: ${ALERT_WEBHOOK_TIMEOUT:10000}
  # 通知重试配置
  notification:
    max-retry: ${ALERT_NOTIFICATION_MAX_RETRY:3}
    retry-interval: ${ALERT_NOTIFICATION_RETRY_INTERVAL:1000}
  # 定时任务配置
  scheduler:
    enabled: ${ALERT_SCHEDULER_ENABLED:true}

# 审批配置
approval:
  # 审批通过后是否自动执行原始请求（默认 true）
  auto-execute: ${APPROVAL_AUTO_EXECUTE:true}

# 代理配置
agentguard:
  proxy:
    # 是否允许访问内网地址，生产环境必须为 false
    allow-internal-address: false
  encryption:
    # 加密密钥（用于加密敏感数据如 LLM API Key）
    # 生产环境必须通过环境变量 ENCRYPTION_KEY 设置，密钥长度建议 32 字节
    key: ${ENCRYPTION_KEY:agentguard-encryption-key-32-bytes-long}

# Spring Boot Actuator 配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
  health:
    redis:
      enabled: true
    db:
      enabled: true
